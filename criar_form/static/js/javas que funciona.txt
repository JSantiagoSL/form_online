document.addEventListener('DOMContentLoaded', function () {
    const formPergunta = document.getElementById('adicionar-pergunta');
    const listaPerguntas = document.getElementById('lista-perguntas');
    let contadorPerguntas = 0;

    formPergunta.addEventListener('submit', function (e) {
        e.preventDefault();
      
        var textoPergunta = this.querySelector('input[name="texto_pergunta"]').value;
        var tipoPergunta = this.querySelector('select[name="tipo_pergunta"]').value;
      
        if (!textoPergunta) {
          alert('Por favor, insira o texto da pergunta.');
          return;
        }
      
        var containerPergunta = document.createElement('div');
        containerPergunta.classList.add('pergunta');
        containerPergunta.dataset.perguntaId = contadorPerguntas;
      
        containerPergunta.innerHTML = `
          <label>${textoPergunta} (${tipoPergunta})</label>
          <input type="hidden" name="perguntas[${contadorPerguntas}][texto]" value="${textoPergunta}">
          <input type="hidden" name="perguntas[${contadorPerguntas}][tipo]" value="${tipoPergunta}">
        `;
      
        if (tipoPergunta === 'curta') {
          var inputCurta = document.createElement('input');
          inputCurta.type = 'text';
          inputCurta.maxLength = 200;
          containerPergunta.appendChild(inputCurta);
        } else if (tipoPergunta === 'multipla_escolha' || tipoPergunta === 'caixa_selecao') {
          var containerOpcoes = document.createElement('div');
          containerOpcoes.classList.add('container-opcoes');
          containerOpcoes.innerHTML = `
            <label>Opções:</label>
            <div class="opcoes" data-pergunta-id="${contadorPerguntas}"></div>
            <button type="button" class="adicionar-opcao" data-pergunta-id="${contadorPerguntas}">Adicionar Opção</button>
          `;
          containerPergunta.appendChild(containerOpcoes);
        } else {
          console.error('Tipo de pergunta desconhecido: ' + tipoPergunta);
        }
      
        listaPerguntas.appendChild(containerPergunta);
        contadorPerguntas++;
      });
      

    document.addEventListener('click', function (e) {
        if (e.target && e.target.classList.contains('adicionar-opcao')) {
            const perguntaId = e.target.dataset.perguntaId;
            const containerOpcoes = document.querySelector(`.opcoes[data-pergunta-id="${perguntaId}"]`);
            const numeroOpcoes = containerOpcoes.children.length;

            const novaOpcao = document.createElement('div');
            novaOpcao.classList.add('opcao');
            novaOpcao.innerHTML = `
                <input type="text" name="perguntas[${perguntaId}][opcoes][${numeroOpcoes}]" placeholder="Opção ${numeroOpcoes + 1}">
                <button type="button" class="remover-opcao">Remover</button>
            `;
            containerOpcoes.appendChild(novaOpcao);
        }
    });

    document.addEventListener('click', function (e) {
        if (e.target && e.target.classList.contains('remover-opcao')) {
            e.target.closest('.opcao').remove();
        }
    });
});